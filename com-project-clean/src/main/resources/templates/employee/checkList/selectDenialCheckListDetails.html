<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	  xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
<title>Project Clean</title>

	<link 
		rel="stylesheet" type="text/css"
		th:href="@{/css/employee/checklist/checkList.css}">
	<script 
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script 
		src="https://code.jquery.com/jquery-3.4.1.min.js"></script>	
	      
</head>
<body>

<section>

	<form method="post" action="admin/checklist/denial"  enctype="multipart/form-data">
	
		<input type="hidden" th:value="${checkList.checkReservationNo}" class="reservationNo" name="reservationNo"> 
		
		<p th:utext="${checkList.checkHTML}" class="jbHtml"></p>			
		
		  <th:block th:if="${ checkList.checkStatus == 'D' }">	
		  
	        <div class="OpnionArea">
		        <div class="employeeOpnionArea">
	   	        	<label>직원 답변</label><br>
	    	        <textarea id="employeeOpnion" class="Opnion" maxlength="300"></textarea>
		        	<textarea id="employeeOpnion2" class="Opnion" maxlength="300" style="display: none"></textarea>
			    </div>
	    	</div>
	    	
	    </th:block>
	    
	<br><br>				
	</form>

</section>

	<th:block th:if="${ checkList.checkStatus == 'D' }">	
	    <input type="button" value="등록" id="submit" class="submittbtn">
	</th:block>
	
	
<!--  textarea script -->
<script>
	
		$("#adminOpnion").prop("readonly", true);
		$("#adminOpnion2").prop("readonly", true);
		
		$('textarea').keyup(function(){
		var letter = $(this).val()
		$('#employeeOpnion2').html(letter)
	})
	
</script>	
<!-- Submit script -->
    <script>
	    
	    const jbHtml = "";
    	
    	document.getElementById("submit").onclick = function(){
			const reservationNo = $('.reservationNo').val();
    		if(confirm("사유서를 제출하시겠습니까? 담당 관리자에게 알람이 전송됩니다.")){
    			
    			document.getElementById("employeeOpnion").remove();
    			document.getElementById("employeeOpnion2").style="";
    			const jbHtml = $( 'section' ).html();

    			$.ajax({
    				url: "submmit",
    				type:"POST",
    				data:{	
    					jbHtml : jbHtml,
    					reservationNo : reservationNo
    				},
    				
    				success: function(data){
    					location.href="/employee/checkList/selectMyCheckList"
		    			alert("전송 완료");
						
    				},
    				error : function(request, status){
    					alert("전송 실패")
    				}
    			})
    		 } 
    	}

    </script>	

<!-- checkbox script -->
<script>
const checkboxs = document.querySelectorAll('form .checklist .checkbox');
for(let i =0; i < checkboxs.length; i++){
	const checkbox = checkboxs[i]
	if(checkbox.value == "NOT"){
		$(checkbox).attr("disabled", true)
	} else if(checkbox.value == "YES") {
		$(checkbox).attr("checked",true)
		$(checkbox).attr("disabled", true)
	};
};
</script>
</body>
	<script 
		src="/js/socket.js"></script>
	<script
		src="http://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
   	<script 
		src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

</html>