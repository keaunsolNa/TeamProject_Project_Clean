<!DOCTYPE html>
<html xmlns:th="http://www.thymleaf.org">
<head>
<meta charset="UTF-8">
<title>ProjectClean</title>
</head>
<body>
	<table align="center" border="1">
		<tr>
			<th>예약 번호</th>
			<th>고객 이름</th>
			<th>시작 시간</th>
			<th>종료 시간</th>
			<th>예상 급여</th>
		</tr>
		<tr th:each="resList : ${ reservationList }">
			<td th:text="${ resList.reservationNo }"></td>
			<td th:text="${ resList.userName }"></td>
			<td th:text="${ resList.businessStartTime }"></td>
			<td th:text="${ resList.businessEndTime }"></td>
			<td th:text="${ resList.totalPayment }"></td>
		</tr>
	</table>
	<div th:include="common/header.html"></div>
	<div th:include="common/taskAside.html"></div>
	
	<table id="taskInfo" border="1">
		<thead>
			<tr>
				<td width="100">예약 번호</td>
				<td width="100">고객 이름</td>
				<td width="200">시작 시간</td>
				<td width="200">종료 시간</td>
				<td width="100">예상 급여</td>
				<td width="100">업무 시작</td>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	 
	 
	<script>
 		let i = 0;
		
			window.onload = function(){
				$.ajax({
					url : "selectMyTask",
					method : "post",
					success:function(data){
						
						const $table = $("#taskInfo tbody");
						$table.html("");
						for(var index in data){
							console.log(i)
							$tr = $("<tr>");
							$noTd = $("<td1>").addClass('rn').text(data[index].reservationNo);
							$nameTd = $("<td>").text(data[index].userName);
							$startTimeTd = $("<td>").addClass('sh').text(data[index].businessStartTime);
							$endTimeTd = $("<td>").text(data[index].businessEndTime);
							$paymentTd = $("<td>").text(data[index].totalPayment)
							$buttonTd = $("<button>제출하기</button>").addClass('btn').addClass([index]);
							
							$tr.append($noTd);
							$tr.append($nameTd);
							$tr.append($startTimeTd);
							$tr.append($endTimeTd);
							$tr.append($paymentTd);
	 						$tr.append($buttonTd); 
							$table.append($tr);
							
							i++
							
			 		 		businessStartTime = data[index].businessStartTime;
							console.log(businessStartTime)  

						};
					},
					error:function(error){
						console.log(error);
					}
				});
				
				setTimeout(function() {
					const buttons = document.querySelectorAll('table#taskInfo tbody tr button');
					
					for(let i = 0; i < buttons.length; i++) {
						var nowtime = new Date();
						nowtime.setMinutes(nowtime.getMinutes() - 30)
						const nowtime2 = nowtime.toString().substring(15, 21);
						console.log(nowtime2)
						
						const button = buttons[i];
						button.onclick = function() {
							const timer = button.parentNode.querySelector('.sh').innerText.substring(10, 16);
							console.log("업무 시간 : " + timer)
							if(timer > nowtime2){
								
								
									const resNo1 = document.querySelectorAll('table#taskInfo tbody tr td1');
									const resNo2 = resNo1[i];
									var resNo3 = resNo2.parentNode.querySelector('.rn').innerText;
									console.log(typeof(resNo3))
								 	location.href="/employee/checklist/insert?re="+ resNo3;
								
							} else{
								alert("업무를 시작할 수 없습니다. ")
							}; 
						}						
	
					}
					
				}, 100)
				
		};
   	</script>
   	
>>>>>>> master
</body>
</html>