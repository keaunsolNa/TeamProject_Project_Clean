<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	  xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
	type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<style>
select{
		width:300px;
		height:34px;
		border:1px solid black;
		font-size:14px !important;
}
a {text-decoration: none !important; 
	color:black !important;
}
section{
	border:4px solid #9AE8F9;
	padding:60px;
}
.payButton {
    width: 63px;
    height: 35px;
   	font-size:12px;
   	cursor: pointer;
	border:1px solid gray;
    border-radius: 5px;
    background-color: rgb(207, 207, 207);
}

.payButton:hover{
    background-color: #9AE8F9;
}
</style>
<title>Insert title here</title>
</head>
<body>
	<div th:include="common/header.html"></div>
	<div th:include="common/payAside.html"></div>
	<section>
		<h2 id="current_date" align="center"></h2>
		<br>
		<form action="/admin/pay/management/bestEmployeePayWaiting" name="modifyForm" id="modifyForm" method="post" align="center">
				<select name="bestEmployeeNo" id="bestEmployeeNo">
					<!-- ajax로 조회 -->
				</select>
				<input class="payButton" type="button" value="급여지급">
		</form>
		
    </section>
</body>
<script>
	// 급여 지급 성공시
	const successMessage = "[[${ modifySuccessMessage }]]";
	if(successMessage){
		Swal.fire({
			  position: 'mid',
			  icon: 'success',
			  title: '성공적으로 지급 되었습니다!',
			  showConfirmButton: false,
			  timer: 3000
			})
	}
	
	// 이번 달 가져오기
	var now = new Date();	// 현재 날짜 및 시간
	var month = now.getMonth() + 1;	// 월
	console.log("월 : ", month);
	document.getElementById('current_date').innerHTML = '<a href="#"> <b style="color:#1aabcb">' + month +'</b>' + '월달의 우수사원 보러가기 </a>' ;
	
	
	
	// select text 가져오기
	var form = $('#modifyForm')
	var employeeName = document.getElementById('bestEmployeeNo');
  
	// submit전에 confirm창 먼저 띄우기
	$(".payButton").click(function(){
		var result = confirm( employeeName.options[employeeName.selectedIndex].text + "님의 " + month + "월달 보너스를 지급하시겠습니까?");
		result;
		
		if(result == true){
			form.submit();
		}
  	
	 });
	
	
	
	// ajax 직원 이름 select로 가져오기
	$(function(){
			$.ajax({
				url: "/admin/pay/employee",
				success: function(data){
					const $employeeNo = $("#bestEmployeeNo");
					$employeeNo.html("");
					
					for (let index in data){
						$employeeNo.append($("<option>").val(data[index].employeeNo).text(data[index].employeeName))
					}
				},
				error: function(xhr){
					console.log(xhr);
				}
			});
		});

	

    
</script>

</html>
