<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	  xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <style>
        body {
            margin-top: 100px;
            font-family: 'Trebuchet MS', serif;
            line-height: 1.6
        }

        /* 전체 크기 */
        .container {
            width: 1500px;
            margin: 0 auto;
        }

    </style>
</head>


<body>

    <div class="container">
    
      <div th:replace="admin/humanResource/vacation/selectAllVacationHeader"></div>
      
      	<form name="myVacationForm" action="/admin/select/selectMyVacation" id="myVacationForm">
        <span>휴가 승인 전체 조회</span>

        <select name="category" id="category">
            <option value="all" selected>전체</option>
            <option value="name">신청자</option>
            <option value="startDate">휴가 시작일</option>
            <option value="endDate">휴가 종료일</option>
        </select>
        
		<input type="text" name="categoryValue" placeholder="블랙리스트 검색">
		<input type="text" style="display: none;"> <!-- enter - submit 방지 -->
		
		<button type="button" id="searchN" onclick="balckListAjax();">검색</button>
		<input type="hidden" value="0" name=page>
	  </form>
	
        <table id="vacationTable" border="1">
            <thead>
                <tr>
                    <th>신청번호</th>
                    <th>신청자</th>
                    <th>신청날짜</th>
                    <th>휴가시작일</th>
                    <th>휴가종료일</th>
                    <th>휴가구분</th>
                    <th>1차 승인여부</th>
                    <th>2차 승인여부</th>
                    <th>반려 여부</th>
                    <th>최종승인여부</th>
                    </tr>
            </thead>
				<tbody>
						
				</tbody>
        </table>
        	<div id="paging" style="display: flex; justify-content: center;">
               <!-- /* 페이징 버튼들어올 공간 */ -->
			</div>
        
    </div>
    
    <script>


    $(document).ready(function(){
  	  balckListAjax();
  	  
    });
    
    /* 페이징 버튼을 통한 요청 함수 */
    function blackListPage(category, categoryValue, page){
       console.log("ajax page이동 실행 시도");
       var queryString = {"category" : category
                    , "categoryValue" : categoryValue
                    , "page" : page};
       balckListAjaxFunction(queryString);
    }
    
    
    /* 유저가 조건 선택해 검색하는 요청 함수 */
    function balckListAjax(){
       console.log("ajax 기본함수 실행 시도");
			
       var queryString = $("form[name=myVacationForm]").serialize();
       balckListAjaxFunction(queryString);
    }
    
    
	  /* 휴가 전체 조회 ajax */
    function balckListAjaxFunction(queryString){
       $.ajax({
          url : "/admin/hr/select/selectAllVacation",
          data : queryString,
          success : function(data){
             const $table = $("#vacationTable tbody");
             const $div = $("#paging");
             
             /* 데이터 필드, 페이징버튼 필드 초기화 */
             $table.html("");
             $div.html("");
             /* search criteria (페이징 버튼으로 ajax요청보낼 때 사용함) */
             category=data.category;
             categoryValue=data.categoryValue;
             
				for ( var index in data.vacationList) {
	                $tr = $("<tr>");   
					$noTd = $("<td>").text(data.vacationList[index].vacationNo);
					$nameTd = $("<td>").text(data.vacationList[index].adminDTO.adminName);
					$requestTd = $("<td>").text(data.vacationList[index].requestDate);
					$startTd = $("<td>").text(data.vacationList[index].vacationStartDate);
					$endTd = $("<td>").text(data.vacationList[index].vacationEndDate);
					$vNameTd = $("<td>").text(data.vacationList[index].vacationName);
					$firstTd = $("<td>").text(data.vacationList[index].vacationFirstConfirmYn);
					$secondTd = $("<td>").text(data.vacationList[index].vacationSecondConfirmYn);
					$returnTd = $("<td>").text(data.vacationList[index].vacationReturnYn);
					$lastTd = $("<td>").text(data.vacationList[index].vacationLastConfirmYn);
							$tr.append($noTd);
							$tr.append($nameTd);
							$tr.append($requestTd);
							$tr.append($startTd);
							$tr.append($endTd);
							$tr.append($vNameTd);
							$tr.append($firstTd);
							$tr.append($secondTd);
							$tr.append($returnTd);
							$tr.append($lastTd);

							$table.append($tr);

							hover();

						}
             
             var $startPage = data.startPage;
             var $endPage = data.endPage;
             var $currentPage = data.currentPage;
             var $maxPage = data.maxPage;
             
             var $beforeStartPage = data.startPage-1;
             var $afterEndPage = data.endPage;
             
             if($startPage==0){
                $button = $("<button class='page' disabled><<</button>");
                $div.append($button);
             } else {
                $button = $("<button class='page' id='goBackPage' onclick='blackListPage(category,categoryValue,"+$beforeStartPage+")'><<</button>");
                $div.append($button);
             }
             
             for(i=$startPage;i<$endPage;i++){
                if(i!=$currentPage){
                   $button = $("<button class='page' onclick='blackListPage(category,categoryValue,"+(i)+")'>"+(i+1)+"</button>");   
                } else {
                   $button = $("<button disabled class='page'>"+(i+1)+"</button>");
                }
                
                $div.append($button);
             }
             
             if($maxPage==$endPage){
                $button = $("<button class='page' disabled>>></button>");
                $div.append($button);
             } else {
                $button = $("<button class='page' id='goForwardPage' onclick='blackListPage(category,categoryValue,"+$afterEndPage+")'>>></button>");
                $div.append($button);
             }
             
          },
          error : function(error){
             console.log(error);
          }
       });
    };

	
			/* hover event */
			function hover() {
				const blackList = document.getElementsByTagName("td");
			
				for (let i = 0; i < blackList.length; i++) {
					blackList[i].onmouseenter = function() {
						this.parentNode.style.backgroundColor = "rgb(50,150,250)";
						this.parentNode.style.cursor = "pointer";
					}
					blackList[i].onmouseout = function() {
						this.parentNode.style.backgroundColor = "white";
					}
			
					blackList[i].onclick = function() {
						location.href = "/admin/selectBlackListDetail/"
								+ this.parentNode.children[0].innerText;
					}
				}
			};
    
    
    
    
	/* hover event */
	function hover() {
		const vacationList = document.getElementsByTagName("td");

		for (let i = 0; i < vacationList.length; i++) {
			vacationList[i].onmouseenter = function() {
				this.parentNode.style.backgroundColor = "rgb(50,150,250)";
				this.parentNode.style.cursor = "pointer";
			}
			vacationList[i].onmouseout = function() {
				this.parentNode.style.backgroundColor = "white";
			}

			vacationList[i].onclick = function() {
				location.href = "/admin/select/selectMyVacation/Detail/"
						+ this.parentNode.children[0].innerText;
			}
		}
	};
	
	$(function(){
	hover();
	})
</script>

</body>

</html>












