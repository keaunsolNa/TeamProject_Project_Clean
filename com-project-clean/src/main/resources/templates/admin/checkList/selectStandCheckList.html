<!DOCTYPE html>
<html xmlns:th="http://www.thymleaf.org"
	  xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
    <link rel="stylesheet"
    	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" >
   	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<title>ProjectClean</title>
</head>
<body>
	<div th:include="common/header.html"></div>
	<div th:include="common/taskAside.html"></div>

	<script>
		const resultMessage = "[[${resultMessage}]]";
		if(resultMessage){
			alert(resultMessage)
		}
	</script>	
	
	<table id="taskInfo" border="1">
		<thead>
			<tr>
				<td width="100">예약 번호</td>
				<td width="100">처리 상태</td>
				<td width="100">고객 이름</td>
				<td width="100">직원 이름</td>
				
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	 
	 
	<script>
		var nowtime = new Date();
		window.onload = function(){
			$.ajax({
				url : "select",
				method : "post",
				success:function(data){
					
					const $table = $("#taskInfo tbody");
					$table.html("");
					for(var index in data){
						$tr = $("<tr>");
						$checkReservationNoTd = $("<td1>").addClass('rn').text(data[index].checkReservationNo);
						$checkStatusTd = $("<td>").text(data[index].checkStatus);
						$checkUserNameTd = $("<td>").text(data[index].customerName);
						$checkEmployeeNameTd = $("<td>").text(data[index].employeeName);
						 
						$tr.append($checkReservationNoTd);
						$tr.append($checkStatusTd);
						$tr.append($checkUserNameTd);
						$tr.append($checkEmployeeNameTd);
						$table.append($tr);
						
					};
				},
				error:function(error){
					console.log(error);
				}
			});
			
 			setTimeout(function() {
				const buttons = document.querySelectorAll('table#taskInfo tbody tr button');
				
				for(let i = 0; i < buttons.length; i++) {
					
					nowtime.setMinutes(nowtime.getMinutes() - 30)
					const nowtime2 = nowtime.toString().substring(15, 21);
					
					const button = buttons[i];
					button.onclick = function() {
						const timer = button.parentNode.querySelector('.st').innerText.substring(10, 16);
						if(timer < nowtime2){
							
								const resNo1 = document.querySelectorAll('table#taskInfo tbody tr td1');
								const resNo2 = resNo1[i];
								var resNo3 = resNo2.parentNode.querySelector('.rn').innerText;
							 	location.href="/employee/checkList/start?re="+ resNo3;
							
						} else{
							alert("업무를 시작할 수 없습니다. ")
						}; 
					}						

				}
				
			}, 100) 
			
	};
   	</script>
   	
</body>
</html>