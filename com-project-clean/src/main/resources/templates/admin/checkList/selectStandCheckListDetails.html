<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	  xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
<title>Project Clean</title>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" >
<link rel="stylesheet" type="text/css"
	th:href="@{/css/employee/checklist/checkList.css}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>	

</head>
<body>

<section>
	<form method="post" action="admin/checklist/denial"  enctype="multipart/form-data">
	
		<input type="hidden" th:value="${checkList.checkReservationNo}" class="reservationNo" name="reservationNo"> 
		
		<p th:utext="${checkList.checkHTML}" class="jbHtml"></p>			
		
		<br><br>				
		
        <div class="OpnionArea">
	        <th:block sec:authorize="hasRole('ADMIN')">
		        <div class="adminOpnionArea">
		            <label>관리자 의견</label><br>
	            	<textarea class="Opnion" cols="100%" rows="3" required></textarea>
	            	<br>
	            	<input type="button" value="승인" id="accpet">
	            	<input type="button" value="거절" id="denial">
		        </div>
			</th:block>
        </div>
        
	</form>
</section>

<!-- Submit script -->
    <script>
	    
	    const jbHtml = "";
    	document.getElementById("denial").onclick = function(){
			const reservationNo = $('.reservationNo').val();
    			const jbHtml = $( 'section' ).html();
    		if(confirm("서류를 반려하시겠습니까? 직원에게 알람이 전송됩니다.")){
    			$.ajax({
    				url: "denial",
    				type:"POST",
    				data:{	
    					jbHtml : jbHtml,
    					reservationNo : reservationNo
    				},
    				
    				success: function(data){
		    			alert("전송 완료");
		    			location.href="/admin/checklist/denial/select"
    				},
    				error : function(request, status){
    					alert("전송 실패")
    				}
    			})
    		 } 
    	}
    	
    	document.getElementById("accpet").onclick = function(){
			const reservationNo = $('.reservationNo').val();
    			const jbHtml = $( 'section' ).html();
    		if(confirm("서류를 승인하시겠습니까? 직원에게 알람이 전송됩니다.")){
    			$.ajax({
    				url: "accpet",
    				type:"POST",
    				data:{	
    					jbHtml : jbHtml,
    					reservationNo : reservationNo
    				},
    				
    				success: function(data){
    					location.href="/admin/checkList/selectStandCheckList"
		    			alert("전송 완료");
						
    				},
    				error : function(request, status){
    					alert("전송 실패")
    				}
    			})
    		 } 
    	}

    </script>	

<!-- checkbox sciprt -->
<script>

	const checkboxs = document.querySelectorAll('form .checklist .checkbox');
		for(let i =0; i < checkboxs.length; i++){
			const checkbox = checkboxs[i]
			if(checkbox.value == "NOT"){
				console.log("폴스")
				$(checkbox).attr("disabled", true)
			} else if(checkbox.value == "YES") {
				console.log("트루")
				$(checkbox).attr("checked",true)
				$(checkbox).attr("disabled", true)
			};
			
		};

</script>



</body>
</html>